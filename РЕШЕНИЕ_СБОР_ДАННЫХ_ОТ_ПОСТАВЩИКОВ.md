# РЕШЕНИЕ: СБОР ДАННЫХ ОТ ПОСТАВЩИКОВ

**Дата:** 2024  
**Версия:** 2.0  
**Статус:** Готово к реализации

---

## 📋 ПОНИМАНИЕ ЗАДАЧИ

### Требования пользователя

Первая вкладка должна называться **"Сбор данных"** и включать:

1. **Создание поставщиков** - регистрация новых поставщиков в системе
2. **Привязка к категориям** - поставщик может быть привязан к нескольким категориям
3. **Отправка запросов** - отметка о том, какому поставщику по каким категориям/подкатегориям отправлен запрос
4. **Отслеживание получения** - контроль получения информации от поставщиков

### Бизнес-логика

Система должна управлять **полным процессом от регистрации поставщика до получения данных**, а не только обработкой уже полученных файлов.

---

## 🎯 ПЕРЕОСМЫСЛЕННЫЙ WORKFLOW

### Полный жизненный цикл данных

```
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 1: СБОР ДАННЫХ                                         │
│  • Регистрация поставщиков                                  │
│  • Привязка к категориям (можно к нескольким)               │
│  • Отправка запросов данных                                  │
│  • Отслеживание получения информации                        │
│  Статусы запросов: new, request_sent, data_received,        │
│                    no_response, cancelled                   │
└─────────────────────────────────────────────────────────────┘
                    ↓ (получен файл)
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 2: В ОБРАБОТКЕ                                         │
│  Файлы импортируются и готовятся                             │
│  Статус: processing                                           │
└─────────────────────────────────────────────────────────────┘
                    ↓ (импорт завершен)
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 3: В КАТАЛОГЕ                                          │
│  Данные загружены в каталог, товары созданы                  │
│  Статус: in_catalog                                          │
└─────────────────────────────────────────────────────────────┘
                    ↓ (экспорт в основную БД)
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 4: ЭКСПОРТИРОВАНО                                      │
│  Данные выгружены в основную БД                              │
│  Статус: exported                                            │
└─────────────────────────────────────────────────────────────┘
```

### Названия вкладок (финальный вариант)

1. **Сбор данных** - регистрация поставщиков, запросы, отслеживание получения
2. **В обработке** - импорт и подготовка файлов
3. **В каталоге** - товары в системе
4. **Экспортировано** - данные в основной БД

---

## 🏗️ АРХИТЕКТУРА РЕШЕНИЯ

### 1. Новая модель: DataRequest

**Назначение:** Отслеживание запросов данных от поставщиков по категориям и подкатегориям.

**Ключевые поля:**
- `supplier_id` - поставщик
- `category_id` - категория
- `subcategory_ids` - список подкатегорий (JSON)
- `status` - статус запроса (new, request_sent, data_received, no_response, cancelled)
- `request_sent_at` - дата отправки
- `data_received_at` - дата получения
- `deadline` - срок получения
- `import_history_id` - связь с файлом (когда получен)

**Статусы:**
- `new` - Новый поставщик, запрос еще не отправлен
- `request_sent` - Запрос отправлен поставщику
- `data_received` - Данные получены от поставщика
- `no_response` - Нет ответа от поставщика
- `cancelled` - Запрос отменен

### 2. Расширение ImportHistory

**Добавлено:**
- `data_request_id` - связь с запросом данных
- `file_status` - статус файла (processing, in_catalog, exported, failed)

### 3. Связи между моделями

```
Supplier
  └─> DataRequest (one-to-many)
      └─> ImportHistory (one-to-many)
          └─> Product (one-to-many)
```

---

## 🎨 UX/UI ДИЗАЙН

### Вкладка "Сбор данных"

#### Структура

```
┌─────────────────────────────────────────────────────────────┐
│  СТАТИСТИКА (4 карточки)                                    │
│  Поставщики | Запросы | Получено | Ожидают                  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  БЫСТРЫЕ ДЕЙСТВИЯ                                            │
│  [➕ Создать поставщика] [📤 Отправить запрос] [📥 Шаблон]  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  ТАБЫ: [Поставщики] [Запросы данных]                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  СОДЕРЖИМОЕ (таблица/карточки)                              │
└─────────────────────────────────────────────────────────────┘
```

#### Раздел "Поставщики"

**Таблица:**
- Код | Название | Категории | Запросы | Статус | Действия

**Индикаторы статуса:**
- 🟢 Есть данные (data_received)
- 🟡 Ожидают ответа (request_sent)
- 🔴 Нет ответа (no_response)
- ⚪ Новый (new)

**Действия:**
- Отправить запрос
- Скачать шаблон
- Редактировать
- Просмотреть

#### Раздел "Запросы данных"

**Таблица:**
- Поставщик | Категория | Подкатегории | Статус | Срок | Отправлен | Получено | Действия

**Badges статусов:**
- Серый - Новый
- Синий - Отправлен
- Зеленый - Получено
- Красный - Нет ответа
- Серый - Отменен

**Индикация сроков:**
- 🔴 Просрочен (красный)
- 🟠 Сегодня (оранжевый)
- ⚪ Будущие (обычный)

**Действия:**
- Отметить получено
- Просмотреть
- Редактировать
- Отменить
- Повторить

### Модальные окна

#### "Отправить запрос"
- Выбор поставщика
- Выбор категории
- Выбор подкатегорий (множественный)
- Установка срока
- Сообщение (опционально)
- Автоматическая генерация шаблона

#### "Отметить получено"
- Загрузка файла (drag & drop)
- Дата получения (автоматически = сегодня)
- Комментарий (опционально)
- Опция автоматического импорта

#### "Создать поставщика" (быстрое)
- Минимальный набор полей
- Привязка к категориям
- Опция сразу отправить запрос

---

## 🔄 WORKFLOW ПЕРЕХОДОВ

### Автоматические переходы

1. **Создание запроса:**
   - `new` → `request_sent` (при отправке запроса)

2. **Получение данных:**
   - `request_sent` → `data_received` (при загрузке файла)
   - Создание `ImportHistory` со статусом `processing`
   - Связывание с `DataRequest`

3. **Импорт:**
   - `processing` → `in_catalog` (при успешном импорте)

4. **Экспорт:**
   - `in_catalog` → `exported` (при экспорте в БД)

### Ручные переходы

- Отменить запрос: `request_sent` → `cancelled`
- Повторить запрос: `no_response` → `request_sent`
- Отметить нет ответа: `request_sent` → `no_response` (при просрочке)

---

## 💡 ПРЕИМУЩЕСТВА РЕШЕНИЯ

### 1. Полный контроль процесса

✅ Видимость всех поставщиков и их статусов  
✅ Отслеживание всех запросов  
✅ Контроль получения данных  
✅ История всех операций  

### 2. Удобство работы

✅ Все действия в одном месте  
✅ Быстрое создание поставщиков и запросов  
✅ Автоматизация рутинных операций  
✅ Понятные статусы и индикаторы  

### 3. Прозрачность

✅ Понятный статус каждого запроса  
✅ История всех операций  
✅ Статистика и аналитика  
✅ Отслеживание сроков  

### 4. Масштабируемость

✅ Поддержка множества поставщиков  
✅ Управление множеством запросов  
✅ Интеграция с внешними системами (будущее)  
✅ Автоматизация (будущее)  

---

## 📊 СТАТИСТИКА И АНАЛИТИКА

### Метрики вкладки "Сбор данных"

1. **Количество поставщиков** - общее количество активных поставщиков
2. **Количество запросов** - активные запросы (request_sent)
3. **Количество получено** - запросы со статусом data_received
4. **Количество ожидают** - запросы без ответа (no_response или просроченные)

### Дополнительная аналитика

- Процент выполнения запросов
- Среднее время получения данных
- Просроченные запросы
- Статистика по поставщикам
- Статистика по категориям

---

## 🚀 ПЛАН РЕАЛИЗАЦИИ

### Этап 1: Модель данных (1 день)
- ✅ Создать модель `DataRequest`
- ✅ Расширить `ImportHistory` (добавить `data_request_id`, `file_status`)
- ✅ Создать модель `ExportHistory`
- ✅ Миграция базы данных

### Этап 2: Сервисы (2 дня)
- ✅ Создать `DataRequestService`
- ✅ Обновить `ImportService` для связи с запросами
- ✅ Создать `ExportService` (базовая версия)
- ✅ Интеграция с существующими сервисами

### Этап 3: UI вкладки "Сбор данных" (3 дня)
- ✅ Раздел "Поставщики" (таблица, фильтры, действия)
- ✅ Раздел "Запросы данных" (таблица, фильтры, действия)
- ✅ Модальные окна (отправить запрос, отметить получено, создать поставщика)
- ✅ Статистика и индикаторы

### Этап 4: Интеграция (1 день)
- ✅ Связь с другими вкладками
- ✅ Обновление существующих страниц
- ✅ Тестирование

### Этап 5: Остальные вкладки (2 дня)
- ✅ Вкладка "В обработке"
- ✅ Вкладка "В каталоге"
- ✅ Вкладка "Экспортировано"

**Итого:** ~9 дней работы

---

## 📝 ИЗМЕНЕНИЯ В ТЗ

### Добавлено в ТЗ:

1. **Раздел 3.4: Сбор данных от поставщиков**
   - Управление поставщиками
   - Запросы данных от поставщиков
   - Отслеживание получения данных
   - Загрузка файлов

2. **Раздел 3.6.5: Вкладки на главной странице**
   - Детальное описание вкладки "Сбор данных"
   - Описание разделов "Поставщики" и "Запросы данных"
   - Описание остальных вкладок

3. **Раздел 3.6.6: Модель данных**
   - Модель `DataRequest`
   - Расширение `ImportHistory`
   - Модель `ExportHistory`
   - Связи между моделями

4. **Раздел 4.2: Главная страница**
   - Обновленная структура с вкладками
   - Описание вкладки "Сбор данных"

---

## 🎯 КЛЮЧЕВЫЕ ОСОБЕННОСТИ

### 1. Единая точка управления

Все действия по работе с поставщиками и запросами в одном месте - вкладка "Сбор данных".

### 2. Прозрачный процесс

Видно:
- Какие поставщики зарегистрированы
- Какие запросы отправлены
- Какие данные получены
- Что ожидает ответа

### 3. Удобные действия

- Быстрое создание поставщика
- Отправка запроса за 2-3 клика
- Автоматическая генерация шаблонов
- Отметка получения данных

### 4. Интеграция с workflow

- Запросы связаны с файлами импорта
- Файлы связаны с товарами
- Полная цепочка от запроса до экспорта

---

## 🔮 БУДУЩЕЕ РАЗВИТИЕ

### Краткосрочные улучшения

1. **Автоматизация:**
   - Автоматическая отправка email при создании запроса
   - Напоминания о просроченных запросах
   - Автоматическое обновление статусов

2. **Интеграции:**
   - Интеграция с email для получения файлов
   - API для поставщиков для загрузки данных
   - Webhook'и для уведомлений

### Долгосрочные улучшения

1. **Планирование:**
   - Планирование запросов
   - Автоматическая отправка по расписанию
   - Шаблоны запросов

2. **Аналитика:**
   - Дашборды с графиками
   - Отчеты по поставщикам
   - Прогнозирование сроков

---

## ✅ ИТОГОВАЯ СТРУКТУРА

### Workflow данных

```
Сбор данных → В обработке → В каталоге → Экспортировано
```

### Workflow запроса

```
Новый → Отправлен → Получено
  ↓         ↓
Отменен  Нет ответа
```

### Workflow товара

```
Черновик → В работе → На проверке → Утвержден → Экспортирован
```

---

**Дата создания:** 2024  
**Версия:** 2.0  
**Статус:** Готово к реализации  
**Документы:**
- `WORKFLOW_СБОР_ДАННЫХ_ОТ_ПОСТАВЩИКОВ.md` - детальное описание
- `UX_UI_ВКЛАДКА_СБОР_ДАННЫХ.md` - дизайн интерфейса
- `ТЕХНИЧЕСКОЕ_ЗАДАНИЕ_СИСТЕМЫ.md` - обновленное ТЗ

