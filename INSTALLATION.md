# ИНСТРУКЦИЯ ПО УСТАНОВКЕ И ЗАПУСКУ

## Требования

- Python 3.10 или выше
- pip (менеджер пакетов Python)
- SQLite (для разработки) или PostgreSQL (для production)

## Установка

### 1. Клонирование и настройка окружения

```bash
# Перейти в директорию проекта
cd DB_products2

# Создать виртуальное окружение
python -m venv venv

# Активировать виртуальное окружение
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate
```

### 2. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 3. Настройка переменных окружения

Создайте файл `.env` в корне проекта:

```env
SECRET_KEY=your-secret-key-here-change-in-production
DATABASE_URL=sqlite:///app.db
```

Для production с PostgreSQL:
```env
DATABASE_URL=postgresql://user:password@localhost/dbname
```

### 4. Инициализация базы данных

```bash
# Инициализация миграций (первый раз)
flask db init

# Создание миграции
flask db migrate -m "Initial migration"

# Применение миграции
flask db upgrade

# Создание администратора по умолчанию
python run.py init-db
```

Будет создан администратор:
- **Логин:** admin
- **Пароль:** admin

⚠️ **ВАЖНО:** Измените пароль после первого входа!

### 5. Запуск приложения

```bash
python run.py
```

Приложение будет доступно по адресу: http://localhost:5000

## Первые шаги

1. **Войти в систему:**
   - Откройте http://localhost:5000
   - Войдите как admin / admin

2. **Создать структуру данных:**
   - Создайте категорию товаров
   - Создайте поставщика в категории
   - Создайте подкатегорию у поставщика
   - Настройте эталонные атрибуты для подкатегории

3. **Импортировать товары:**
   - Перейдите в раздел "Импорт"
   - Выберите поставщика и подкатегорию
   - Загрузите файл (Excel, CSV или JSON)
   - Товары будут автоматически импортированы и верифицированы

## Использование CLI команд

### Импорт товаров через командную строку

```bash
flask import-products path/to/file.xlsx --supplier-id 1 --subcategory-id 1
```

Опции:
- `--supplier-id` - ID поставщика (обязательно)
- `--subcategory-id` - ID подкатегории (обязательно)
- `--no-verify` - не выполнять автоматическую верификацию

## Миграции базы данных

При изменении моделей данных:

```bash
# Создать миграцию
flask db migrate -m "Описание изменений"

# Применить миграцию
flask db upgrade

# Откатить миграцию (если нужно)
flask db downgrade
```

## Production развертывание

1. **Использовать PostgreSQL:**
   ```env
   DATABASE_URL=postgresql://user:password@localhost/dbname
   ```

2. **Изменить SECRET_KEY:**
   ```env
   SECRET_KEY=сгенерируйте-случайный-секретный-ключ
   ```

3. **Настроить WSGI сервер:**
   - Используйте Gunicorn или uWSGI
   - Настройте Nginx как reverse proxy

4. **Отключить debug режим:**
   В `run.py` измените:
   ```python
   app.run(debug=False)
   ```

## Устранение неполадок

### Ошибка при импорте
- Проверьте формат файла (должен быть .xlsx, .xls, .csv или .json)
- Убедитесь, что файл содержит необходимые колонки (SKU, название)
- Проверьте кодировку CSV файла

### Ошибки базы данных
- Убедитесь, что миграции применены: `flask db upgrade`
- Проверьте права доступа к файлу базы данных

### Проблемы с зависимостями
- Убедитесь, что виртуальное окружение активировано
- Переустановите зависимости: `pip install -r requirements.txt --force-reinstall`

---

**Дата создания:** 2024

